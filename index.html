<!DOCTYPE html>
<html lang="en">
    
    <head>
        
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="Jari Prachasartta & Randy Lo" />
        <title>Northern Triangle Migration and the Global Food Supply Chain</title>
        
<!--
         Favicon
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
-->
        <!--Font Awesome icons (free version)-->
        <!--<script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>-->
        
        <link href="https://fonts.googleapis.com/css2?family=Karla:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/styles.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        
        <link rel="stylesheet" href="css/styles.css"/>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/ScrollMagic.min.js"></script>
        <!--<script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
        
        <script src="https://d3js.org/d3-scale-chomatic.v1.min.js"></script>
        -->
        <script src="https://d3js.org/d3.v4.js"></script>
        
        
    </head>
    
    
    <body>



        <nav role="navigation" class="container.fluid">
            
            <div class="row">
                <div class="col-1"></div>
                <div class="col-6">
                    <br>
                    <br>
                    <nav class="navbar navbar-light navbar-1 white">
                        <!-- Navbar brand -->
                        <a class="navbar-projectname" a href=#>Northern Triangle Migration and the Global Food Supply Chain</a>
                    </nav>
                </div>
                <div class="col-1"></div>
                <div class="col-3">
                    <br>
                    <br>
                    <br>
                  
                    <div class="navbar-right ml-auto">
                        <a href="about.html">about</a>
                        &nbsp;
                        <a href="contact.html">contact</a>

                    </div>
                    
                </div>
                <div class="col-1"></div>

                                
            </div>
        </nav>
        
        
        
        
        <br>
        <br>
        <br>
        <br>
        
        
        
        
        <main role = main>
            
             <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-10">
                    <div id="content_top">
                        
                        <img src="https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/image01.png" alt="Northern Triangle Countries" width="100%" >
        
                    </div>
               
                <div class="col-1"></div>
            </div>
            </div>
            
            <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-10">
                    <div id="content_l_1">
                        
                        <hr1>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                       
                        What is the economic importance of the Northern Triangle countries as exporters of agricultural products to the rest of the world?
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        What does the Northern Triangle migration mean for the global food supply chain?
                        
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        </hr1>
                        
                        
                    </div>
                </div>
                <div class="col-1"></div>
            </div>
    
            
            
            
            
            <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-6">
                    <div id="content_l_2">
                        
                        
                        
                        <img src="https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/image02.jpeg" alt="The Migrant Caravan. Credit: Migration Data Portal" width="100%">
                       
                        <img src="https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/image03.jpeg" alt="A group of Central American migrants take a break on train tracks in Arriaga, Chiapas, on their way to the United States. Credit: Christian Palma" width="100%">
                      
                        <img src="https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/Image04.jpeg" alt="Credit: Adrees Latif | Reuters" width="100%">
                       
                
                    </div>
                </div>
                <div class="col-1"></div>
                <div class="col-3">
                    <div id="content_r_2">
                        <h1></h1>
                        
                        
                        <hr1>Since 2014, more than two million people are estimated to have fled Honduras, El Salvador and Guatemala.</hr1>
                 
                    </div>
                    </div>
                <div class="col-1"></div>
            </div>
        
        

            <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-6">
                    <div id="content_l_3">
                       
                        <br>
                        <h1>Background and Introduction</h1>
                        <br>
                        
                        <p>
                        Guatemala, Honduras and El Salvador, which comprise the Northern Triangle, face many of the political, economic and social issues that contribute to the region's overall instability. 
                        <br>
                        <br>
                        Economically, The Northern Triangle is one of the poorest regions in the Western Hemisphere. By GDP per capita, all three countries are in the bottom six of the 32 Latin American and Caribbean countries.
                        <br>
                        <br>
                            
                        Simultaneously, they rank among the countries which contribute the most to migration, and are among the region's most troubled countries in terms of violence, poverty, economic instability, and climate extremes. The Covid-19 pandemic, as well as the two hurricanes, Eta and Iota, that hit the region in November 2020, aggravated existing issues of poor governance, lack of security, and unequal economic growth, and contributed to the push for migration. 
                        <br>
                        <br>
                            
                
                        Hondurans account for the largest share of Northern Triangle migrants intercepted by U.S. border authorities, followed by Guatemalans and Salvadorans respectively. Given the area's high levels of poverty, violence, and insecurity, the Northern Triangle's humanitarian crisis has gotten worse in the last year. Nearly 15% of those surveyed by the World Food Programme in January 2021 said they were making concrete plans to leave their home country.
                        </p>
                        
                    </div>
                </div>
                <div class="col-1"></div>
                <div class="col-3">
                    <div id="content_r_3">
                        <h1></h1>
                
                        <br>
                        <br>
                        <br>
                        <hr1>15% of those surveyed by the World Food Programme in January 2021 said they were making concrete plans to leave their home country.</hr1>
                    </div>
                </div>
                <div class="col-1"></div>
            </div>
            
            
            
            
            
            <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-6">
                    <div id="content_l_4">
                        <br><br>
                        <img src="https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/image07.jpeg" alt="Two hurricanes destroyed bridges, roads, schools, health clinics and homes. Here is the aftermath in ProtecciÃ³n in Honduras' Santa Barbara department on Dec. 11. Credit: Edison Umanzur | AFP via Getty Images" width="100%">
                        
                        <img src="https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/image05.jpeg" alt="Mercedes Morales walks through what remains of her home in the village of Aldea El Coowle, San Manuel Cortes, Honduras, on April 9, 2021. The house was completely destroyed by hurricanes Eta and Iota in November 2020. Credit: Yael MartÃ­nezâMagnum Photos for TIME" width="100%">
                
                        
                        
                        <img src="https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/image08.jpeg" alt="A farmer shows the native maize being grown by families in local communities in an aim to diversify crops in the area. Credit: JEANNE MULLER" width="100%">
                       
                        
                        
                    </div>
                </div>
                <div class="col-1"></div>
                <div class="col-3">
                    <div id="content_r_4">
                        <h1></h1>
                        <br>
                        <hr1>
                        How does this increase in outward migration affect the global food supply chain?
                        </hr1>
                    </div>
                <div class="col-1"></div>
            </div>
            
            
            
            
            <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-6">
                    <br><br><br><br><br>
                    <h1>Occupational Composition of Migrants</h1>
                    <br>
    

<!--
                    <button class ="buttonOccupation"onclick="TurnOnOccupation()">Before Migration</button>
                    <button class ="buttonOccupation"onclick="TurnOnOccupationAfter()">After Migration</button>
-->
                    

                    <div id="viz_occupation"></div>
<!--                    <div id="viz_occupation_after"></div> -->
                
    
                    <div id="content_l_9">
                        
                        <br>
                        <p>According to the interview conducted by the World Food Programme in 2021, on average, 28% of migrants from Honduras, El Salvador and Guatemala had previously worked in agricultural productions or labor. </p>
                        
                        <br>
                       
                    </div>
                </div>
            
                <div class="col-1"></div>
                <div class="col-3 ">
                    <div id="content_r_9">
                        <br><br><br><br><br><br><br><br><br><br><br>
                        <hr1>On average, 28% of migrants from <hr1b>Honduras</hr1b>, <hr1p>El Salvador</hr1p> and <hr1g>Guatemala</hr1g> had previously worked in agricultural productions or labor.</hr1>
                    </div>
                    
                </div>
                <div class="col-1"></div>
            </div>
            
            
        
            <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-6">
                    <br><br><br>
                    <h1>Migration and Agricultural Exports Trends</h1>
                    <br>
                    
                    <br>
                    <button class ="buttonTotal"onclick="TurnOnTotalMigrant()">Number of Migrants</button>
                    <button class ="buttonTotal"onclick="TurnOnTotalExport()">Export of Agricultural Products</button>
                    
                    <div id="viz_totalmigrant"></div>
                    <div id="viz_totalexport"></div> 
                </div>
                    
                <div class="col-1"></div>
                <div class="col-3 ">
                    <div id="content_r_5">
                    <br>
                    <br>
                    <br>
                    <br>
                    <br>
                    <br>
                    <br>
                    <br>
                    <br>
                    <br>
                    <hr1>What does this trend imply? Are we seeing a future decline of exports of agricultural products?</hr1>
                        
                    </div>
                    
                </div>
                <div class="col-1"></div>
            </div>
            

            
                <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-6"> 
                    <div id="content_l_6"></div>
                        <br>
                        <br>
                        <h1>Role of the Northern Triangle Countries as Food Exporters</h1>
                        
                        <br>
                        <p>
                        
                        
                            
                        Guatemala is the horticultural hub for Central America. The agricultural sector is a significant part of Guatemalaâs economy accounting for around 25% of the GDP and employing 50% of the labour force. The main crops are coffee, sugarcane, bananas and cotton. 
                        <br>  
                        <br>
                        Honduras is abundant with agricultural land, forest and marine resources. The share of agriculture in the country's GDP decreased sharply from 21.6 percent in the late 1980s to 14% in 2001 and has continued to decreased. Agriculture, however, is still the primary sector of the economy.
                        <br>
                        <br>
                        El Salvador, too, is predominantly an agricultural country. Despite the fact that agriculture only accounted for 9.3% of the GDP and employed 35.5% of the economically active population in 1992. Approximately 57% of the country's population lives in rural areas and about 75% of the country's basic grains are produced on family farms. Coffee, sugar cane and cotton are the main cash crops. Shrimps were also an important export. The country's agricultural strategy aims to inprove rural income through increased productivity as well as agricultural exports and foreign exchange revenues.
                
                    
                        </p>
                </div>
                    
            
                
                <div class="col-1"></div>
                <div class="col-3 ">
                    <div id="content_r_6">
                    <br>
                    <br>
                    <hr1>
                    Honduras, El Salvador and Guatemala are predominantly agricultural countries.
                    </hr1>
                    
                    </div>
                    
                </div>
                <div class="col-1"></div>
            </div>
            
            
            <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-6">
                    <div id="content_l_7">
                        <br>
                        <h1>Export Basket of Honduras</h1>
                        <br>
                        <br>
                        <button class ="buttonTotal"onclick="TurnOnHND2019()">Honduras 2019</button>
                        <button class ="buttonTotal"onclick="TurnOnHND2020()">Honduras 2020</button>
                       
                        
                        <div id="viz_treemap_hnd_2019"></div>
                        <div id="viz_treemap_hnd_2020"></div>
                        <br>
                        <br>
                        <br>
                        <h1>Export Basket of El Salvador</h1>
                        <br>
                        <br> 
                        <button class ="buttonTotal"onclick="TurnOnSLV2019()">El Salvador 2019</button>
                        <button class ="buttonTotal"onclick="TurnOnSLV2020()">El Salvador 2020</button>
                        
                        
                        <div id="viz_treemap_slv_2019"></div>
                        <div id="viz_treemap_slv_2020"></div>
                        <br>
                        <br>
                        <br>
                        <h1>Export Basket of Guatemala</h1>
                        <br> 
                        <br>
                        <button class ="buttonTotal"onclick="TurnOnGTM2019()">Guatemala 2019</button>
                        <button class ="buttonTotal"onclick="TurnOnGTM2020()">Guatemala 2020</button>
                        
                        <div id="viz_treemap_gtm_2019"></div>
                        <div id="viz_treemap_gtm_2020"></div>
                        
                        
                        <br>
                        <br>
                        <br>
                        <p>
                        While exports of agricultural products from Honduras and  Salvador decreased, Guatemala, on the other hand, saw an increase from 2019 to 2020. This could be due to the fact that the agricultural sector of Guatemala's economy consists of two types of producers which include small-scale peasant-owned farms in the highlands, and medium to large-scale operations in the more fertile lowland.
                            
                        <br>
                        <br>
                        These smaller farms produce staples such as beans and maize for domestic consumption as well as fruits and vegetables for export. Larger farms, on the other hand, produce predominantly plantation and export products including, for instance, bananas, sugar cane, coffee, and palm oil.
                            
                        <br>
                        <br>
                        While 92% of farms in Guatemala are small, 88% of agricultural land is in large-scale operations. These large farms employ fewer people and produce 1/3 more per hectare than small farms. The scale difference is debatably what contributed to the increase in total export in 2020.
                        
                        </p>
                    

                       
                    </div>
                </div>
                
                
                
                <div class="col-1"></div>
                <div class="col-3 ">
                    <div id="content_r_7">
                        <h1></h1>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <hr1>While exports of agricultural products from <hr1b>Honduras</hr1b> and <hr1p>El Salvador</hr1p> decreased, <hr1g>Guatemala</hr1g>, on the other hand, saw an increase from 2019 to 2020.</hr1>
                    
                    </div>
                    
                    
                </div>
                <div class="col-1"></div>
            </div>
            
            
            
            
            
            
<!--
            <div class="row row-content">
                <div class="col-1"></div>
                <div class="col-6">
                    <div id="content_l_8">
                        <h1></h1>
                        
                     
                        <br>
                        <p>
                        <br>
                        <br>
                     
                        
                        
                        </p>
                        
                        <br>
                   
                       
                    </div>
                </div>
                
                
                <div class="col-1"></div>
                <div class="col-3 ">
                    <div id="content_r_8">
                        <br>
                        <br>
                        <br>
                        <hr1>text</hr1>
                    </div>
                    
                </div>
                <div class="col-1"></div>
            </div>
            
            
-->
            
            
            
            <div class="row row-contentt">
                <div class="col-1"></div>
                <div class="col-6">
                    <div id="content_l_10">
                        <br><br>
                        <h1>Northern Triangle Migration & Global Food Supply Chain</h1> 
                        
                        <br>
                        <p>
    
                        Migration indeed is a complex issue. Not only that it can mean greater insecurity for the population of these countries, in the long run, migration can negatively impact the global food supply chain as these countries are exporters of agricultural products to the global market. 
                            
                        While most research focuses on the drivers such as violence and economic factors, it is also crucial to analyze the impact it has at both the local and the global scales. Our finding suggests that there is no direct correlation between outward migrantion and the global agricultural supply chain. However, this is only part of the story. It can be argued that other interrelated factors, such as Free Trade Agreements, and scales of operation, also account for the change in the global agricultural supply chain. Therefore, 
                        they should also be analyzed in relation to what was analyzed in this study to understand the extent of the intertwined root causes of change in the global agricultural supply chain trend.
                            
                            
                        
                            
                        <br>
                        <br>
                    

                        </p>
                        
                    </div>
                </div>
                
                <div class="col-1"></div>
                <div class="col-3 ">
                    <div id="content_r_10">
                        <br>
                        <br>
                        <br><br>
                        <br>
                        <hr1>No direct correlation between outward migration and the global agricultural supply chain</hr1>
                    </div>
                    
                </div>
                <div class="col-1"></div>
            </div>
            </div>
            
          
            
        </main>
        
     
            
        <!-- Load d3.js -->
<script>
        
        var controller = new ScrollMagic.Controller();

            new ScrollMagic.Scene({triggerElement: "#content_l_1"})
            .setClassToggle(".text1opacity", "active")
            .addTo(controller);

            new ScrollMagic.Scene({triggerElement: "#content_r_1"})
            .setClassToggle(".text2opacity", "active")
            .addTo(controller);

            new ScrollMagic.Scene({triggerElement: "#content_l_2"})
            .setClassToggle(".text3opacity", "active")
            .addTo(controller);

            new ScrollMagic.Scene({triggerElement: "#content_r_2"})
            .setClassToggle(".img", "active")
            .addTo(controller);
    
       function TurnOnTotalMigrant(){
        var chartMigrant = document.getElementById("viz_totalmigrant");
        var chartExport = document.getElementById("viz_totalexport");
        
        
        if (chartMigrant.innerHTML == "") {
            buildTotalMigrantChart();
            chartExport.innerHTML = "";
        }
    }
    window.onload = function() {
//        window.onload();
        TurnOnTotalMigrant();
    }
    function TurnOnTotalExport(){
        var chartMigrant = document.getElementById("viz_totalmigrant");
        var chartExport = document.getElementById("viz_totalexport");

        
        if (chartExport.innerHTML == "") {
            buildTotalExportChart();
            chartMigrant.innerHTML = "";
        }
    }
    

    function TurnOnOccupation(){
        var chartOccupation = document.getElementById("viz_occupation");
        var chartOccupationAfter = document.getElementById("viz_occupation_after");
        

        
        if (chartOccupation.innerHTML == "") {
            buildOccupationChart();
            chartOccupationAfter.innerHTML = "";
        }
    }
    window.onload = function() {
//        window.onload();
        TurnOnOccupation();
    }
    function TurnOnOccupationAfter(){
        var chartOccupation = document.getElementById("viz_occupation");
        var chartOccupationAfter = document.getElementById("viz_occupation_after");
        
        
        if (chartOccupationAfter.innerHTML == "") {
            buildOccupationAfterChart();
            chartOccupation.innerHTML = "";
        }
    }
    
    
    
    
    

    
    

    function TurnOnHND2019(){
        var chartHND2019 = document.getElementById("viz_treemap_hnd_2019");
        var chartHND2020 = document.getElementById("viz_treemap_hnd_2020");
        
        
        if (chartHND2019.innerHTML == "") {
            buildHND2019Chart();
            chartHND2020.innerHTML = "";
        }
    }
    window.onload = function() {
//        window.onload();
        TurnOnHND2019();
    }
    
    function TurnOnHND2020(){
        var chartHND2019 = document.getElementById("viz_treemap_hnd_2019");
        var chartHND2020 = document.getElementById("viz_treemap_hnd_2020");

        
        if (chartHND2020.innerHTML == "") {
            buildHND2020Chart();
            chartHND2019.innerHTML = "";
        }
    }

    
    function TurnOnSLV2019(){
        var chartSLV2019 = document.getElementById("viz_treemap_slv_2019");
        var chartSLV2020 = document.getElementById("viz_treemap_slv_2020");
        
        
        if (chartSLV2019.innerHTML == "") {
            buildSLV2019Chart();
            chartSLV2020.innerHTML = "";
        }
    }
    window.onload = function() {
//        window.onload();
        TurnOnSLV2019();
    }
    
    function TurnOnSLV2020(){
        var chartSLV2019 = document.getElementById("viz_treemap_slv_2019");
        var chartSLV2020 = document.getElementById("viz_treemap_slv_2020");

        
        if (chartSLV2020.innerHTML == "") {
            buildSLV2020Chart();
            chartSLV2019.innerHTML = "";
        }
    }
    

    
    
    function TurnOnGTM2019(){
        var chartGTM2019 = document.getElementById("viz_treemap_gtm_2019");
        var chartGTM2020 = document.getElementById("viz_treemap_gtm_2020");
        
        
        if (chartGTM2019.innerHTML == "") {
            buildGTM2019Chart();
            chartGTM2020.innerHTML = "";
        }
    }
    window.onload = function() {
//        window.onload();
        TurnOnTotalMigrant();
        TurnOnOccupation();
        TurnOnHND2019();
        TurnOnSLV2019();
        TurnOnGTM2019();
    }
    
    function TurnOnGTM2020(){
        var chartGTM2019 = document.getElementById("viz_treemap_gtm_2019");
        var chartGTM2020 = document.getElementById("viz_treemap_gtm_2020");

        
        if (chartGTM2020.innerHTML == "") {
            buildGTM2020Chart();
            chartGTM2019.innerHTML = "";
        }
    }

    
    
    
////////////////////
    
//TOTAL MIGRANT CHART
    
////////////////////
    
    
const buildTotalMigrantChart = function() {
    var width = document.getElementById('viz_totalmigrant').clientWidth;
    ////this allows us to collect the width of the div where the SVG will go.
    var height = width / 3.236;
    //I like to use the golden rectangle ratio if they work for my charts.

    //var svg = d3.select('#viz_totalmigrant').append('svg');
    //We add our svg to the div area


    // set the dimensions and margins of the graph
var margin = {top: 60, right: 230, bottom: 5, left: 80},
    width = 1050 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#viz_totalmigrant")
      .append("svg")
        .attr("id","svg_viz_totalmigrant") //change the id for total export svg 
        .attr("display","block") // display == none for total export svg
        .attr("width", "100%")
        .attr("height", "100%")
      .classed("svg_container-totalmigrant",true)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    // Parse the Data
    d3.csv("https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/Totalnumberofmigrants.csv", function(data) {


      //////////
      // GENERAL //
      //////////

      // List of groups = header of the csv files
      var keys = data.columns.slice(1)

      // color palette
      var color = d3.scaleOrdinal()
        .domain(keys)
        .range(['#3DADFE','#F628C6','#47E380'])

      //stack the data?
      var stackedData = d3.stack()
        .keys(keys)
        (data)



      //////////
      // AXIS //
      //////////

      // Add X axis
      var x = d3.scaleLinear()
        .domain(d3.extent(data, function(d) { return d.year; }))
        .range([ 0, width ]);
      var xAxis = svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).ticks(5).tickFormat(d3.format("d")))

      // Add X axis label:
      svg.append("text")
          .attr("text-anchor", "end")
          .attr("x", width)
          .attr("y", height+40 )
          .text("");

      // Add Y axis label:
    //  svg.append("text")
    //      .attr("text-anchor", "end")
    //      .attr("x", 0)
    //      .attr("y", -20 )
    //      .text("# of migrants")
    //      .attr("text-anchor", "start")

      // Add Y axis
      var y = d3.scaleLinear()
        .domain([0, 8000000])
        .range([ height, 0 ]);
    
      svg.append("g")
        .call(d3.axisLeft(y).ticks(5))



      //////////
      // BRUSHING AND CHART //
      //////////

      // Add a clipPath: everything out of this area won't be drawn.
      var clip = svg.append("defs").append("svg:clipPath")
          .attr("id", "clip")
          .attr("class","clip-path")
          .append("svg:rect")
          .attr("width", width )
          .attr("height", height )
          .attr("x", 0)
          .attr("y", 0);

      // Add brushing
      var brush = d3.brushX()                 // Add the brush feature using the d3.brush function
          .extent( [ [0,0], [width,height] ] ) // initialise the brush area: start at 0,0 and finishes at width,height: it means I select the whole graph area
          .on("end", updateChart) // Each time the brush selection changes, trigger the 'updateChart' function

      // Create the scatter variable: where both the circles and the brush take place
      var areaChart = svg.append('g')
        .attr("clip-path", "url(#clip)")

      // Area generator
      var area = d3.area()
        .x(function(d) { return x(d.data.year); })
        .y0(function(d) { return y(d[0]); })
        .y1(function(d) { return y(d[1]); })

      // Show the areas
      areaChart
        .selectAll("mylayers")
        .data(stackedData)
        .enter()
        .append("path")
          .attr("class", function(d) { return "myArea " + d.key })
          .style("fill", function(d) { return color(d.key); })
          .attr("d", area)
          .attr("stroke", "black",)
          .attr("stroke-width", 2.5,)

      // Add the brushing
      areaChart
        .append("g")
          .attr("class", "brush")
          .call(brush);

      var idleTimeout
      function idled() { idleTimeout = null; }

      // A function that update the chart for given boundaries
      function updateChart() {

        extent = d3.event.selection

        // If no selection, back to initial coordinate. Otherwise, update X axis domain
        if(!extent){
          if (!idleTimeout) return idleTimeout = setTimeout(idled, 350); // This allows to wait a little bit
          x.domain(d3.extent(data, function(d) { return d.year; }))
        }else{
          x.domain([ x.invert(extent[0]), x.invert(extent[1]) ])
          areaChart.select(".brush").call(brush.move, null) // This remove the grey brush area as soon as the selection has been done
        }

        // Update axis and area position
        xAxis.transition().duration(1000).call(d3.axisBottom(x).ticks(5))
        areaChart
          .selectAll("path")
          .transition().duration(1000)
          .attr("d", area)
        }



        //////////
        // HIGHLIGHT GROUP // 
        //////////

        // What to do when one group is hovered
        var highlight = function(d){
//          console.log(d)
          // reduce opacity of all groups
          d3.selectAll(".myArea").style("opacity", .1)
          // expect the one that is hovered
          d3.select("."+d).style("opacity", 1)
        }

        // And when it is not hovered anymore
        var noHighlight = function(d){
          d3.selectAll(".myArea").style("opacity", 1)
        }



        //////////
        // LEGEND //
        //////////

        // Add one dot in the legend for each name.
        var size = 18
        svg.selectAll("myrect")
          .data(keys)
          .enter()
          .append("rect")
            .attr("x", 720)
            .attr("y", function(d,i){ return 10 + i*(size+10)}) // 100 is where the first dot appears. 25 is the distance between dots
            .attr("width", size)
            .attr("height", size)
            .style("fill", function(d){ return color(d)})
//            .style("stroke", "#000000")
            .on("mouseover", highlight)
            .on("mouseleave", noHighlight)

        // Add one dot in the legend for each name.
        svg.selectAll("mylabels")
          .data(keys)
          .enter()
          .append("text")
            .attr("x", 688 + size*1.2)
            .attr("y", function(d,i){ return 10 + i*(size+10) + (size/2)}) // 100 is where the first dot appears. 25 is the distance between dots
            .style("fill", function(d){ return color(d)})
            .text(function(d){ return d})
            .attr("text-anchor", "end")
            .style("alignment-baseline", "middle")
            .on("mouseover", highlight)
            .on("mouseleave", noHighlight)

    })

     //We will build a basic function to handle window resizing.
    function resize() {
        width = document.getElementById('viz_totalmigrant').clientWidth;
        height = width / 3.236;
        d3.select('#viz_totalmigrant svg') //this needs to be changed so that the chart is responsinve 
          .attr('width', width)
          .attr('height', height);
    }

    window.onresize = resize;
    //Call our resize function if the window size is changed.   
    
}
    
    
////////////////////
//    
// TOTAL EXPORT CHART  
//    
////////////////////
//    
//    
const buildTotalExportChart = function() {
    
    // set the dimensions and margins of the graph
var margin = {top: 60, right: 230, bottom: 5, left: 80},
    width = 1050 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#viz_totalexport")
  .append("svg")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("display","block") 
    .classed("svg_container-totalmigrant",true)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

// Parse the Data
d3.csv("https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/TotalExport19952020.csv", function(data) {


  //////////
  // GENERAL //
  //////////

  // List of groups = header of the csv files
  var keys = data.columns.slice(1)

  // color palette
  var color = d3.scaleOrdinal()
    .domain(keys)
    .range(['#3DADFE','#F628C6','#47E380']);

  //stack the data?
  var stackedData = d3.stack()
    .keys(keys)
    (data)



  //////////
  // AXIS //
  //////////

  // Add X axis
  var x = d3.scaleLinear()
    .domain(d3.extent(data, function(d) { return d.year; }))
    .range([ 0, width ]);
  var xAxis = svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).ticks(5).tickFormat(d3.format("d"))
    )

  // Add X axis label:
  svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", width)
      .attr("y", height+40 )
      .text("");

  // Add Y axis label:
//  svg.append("text")
//      .attr("text-anchor", "end")
//      .attr("x", 0)
//      .attr("y", -20 )
//      .text("Total Export")
//      .attr("text-anchor", "start")

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([0, 20000000000])
    .range([ height, 0 ]);
  svg.append("g")
    .call(d3.axisLeft(y).ticks(5))



  //////////
  // BRUSHING AND CHART //
  //////////

  // Add a clipPath: everything out of this area won't be drawn.
  var clip = svg.append("defs").append("svg:clipPath")
      .attr("id", "clip")
      .append("svg:rect")
      .attr("width", width )
      .attr("height", height )
      .attr("x", 0)
      .attr("y", 0);

  // Add brushing
  var brush = d3.brushX()                 // Add the brush feature using the d3.brush function
      .extent( [ [0,0], [width,height] ] ) // initialise the brush area: start at 0,0 and finishes at width,height: it means I select the whole graph area
      .on("end", updateChart) // Each time the brush selection changes, trigger the 'updateChart' function

  // Create the scatter variable: where both the circles and the brush take place
  var areaChart = svg.append('g')
    .attr("clip-path", "url(#clip)")

  // Area generator
  var area = d3.area()
    .x(function(d) { return x(d.data.year); })
    .y0(function(d) { return y(d[0]); })
    .y1(function(d) { return y(d[1]); })

  // Show the areas
  areaChart
    .selectAll("mylayers")
    .data(stackedData)
    .enter()
    .append("path")
      .attr("class", function(d) { return "myArea " + d.key })
      .style("fill", function(d) { return color(d.key); })
      .attr("d", area)
      .attr("stroke", "black",)
      .attr("stroke-width", 2.5,)

  // Add the brushing
  areaChart
    .append("g")
      .attr("class", "brush")
      .call(brush);

  var idleTimeout
  function idled() { idleTimeout = null; }

  // A function that update the chart for given boundaries
  function updateChart() {

    extent = d3.event.selection

    // If no selection, back to initial coordinate. Otherwise, update X axis domain
    if(!extent){
      if (!idleTimeout) return idleTimeout = setTimeout(idled, 350); // This allows to wait a little bit
      x.domain(d3.extent(data, function(d) { return d.year; }))
    }else{
      x.domain([ x.invert(extent[0]), x.invert(extent[1]) ])
      areaChart.select(".brush").call(brush.move, null) // This remove the grey brush area as soon as the selection has been done
    }

    // Update axis and area position
    xAxis.transition().duration(1000).call(d3.axisBottom(x).ticks(5))
    areaChart
      .selectAll("path")
      .transition().duration(1000)
      .attr("d", area)
    }



    //////////
    // HIGHLIGHT GROUP //
    //////////

    // What to do when one group is hovered
    var highlight = function(d){
//      console.log(d)
      // reduce opacity of all groups
      d3.selectAll(".myArea").style("opacity", .1)
      // expect the one that is hovered
      d3.select("."+d).style("opacity", 1)
    }

    // And when it is not hovered anymore
    var noHighlight = function(d){
      d3.selectAll(".myArea").style("opacity", 1)
    }



    //////////
    // LEGEND //
    //////////

    // Add one dot in the legend for each name.
        var size = 18
        svg.selectAll("myrect")
          .data(keys)
          .enter()
          .append("rect")
            .attr("x", 720)
            .attr("y", function(d,i){ return 10 + i*(size+10)}) // 100 is where the first dot appears. 25 is the distance between dots
            .attr("width", size)
            .attr("height", size)
            .style("fill", function(d){ return color(d)})
//            .style("stroke", "#000000")
            .on("mouseover", highlight)
            .on("mouseleave", noHighlight)

        // Add one dot in the legend for each name.
        svg.selectAll("mylabels")
          .data(keys)
          .enter()
          .append("text")
            .attr("x", 688 + size*1.2)
            .attr("y", function(d,i){ return 10 + i*(size+10) + (size/2)}) // 100 is where the first dot appears. 25 is the distance between dots
            .style("fill", function(d){ return color(d)})
            .text(function(d){ return d})
            .attr("text-anchor", "end")
            .style("alignment-baseline", "middle")
            .on("mouseover", highlight)
            .on("mouseleave", noHighlight)

})
    
    

         //We will build a basic function to handle window resizing.
//    function resize() {
//        width = document.getElementById('viz_totalexport').clientWidth;
//        height = width / 3.236;
//        d3.select('#viz_totalexport svg') //this needs to be changed so that the chart is responsinve 
//          .attr('width', width)
//          .attr('height', height);
//    }

    //window.onresize = resize;
    ////Call our resize function if the window size is changed.   
    

}
    



            
////////////////////        
            
//OCCUPATION CHART  (BEFORE)
    
////////////////////
            
const buildOccupationChart = function() { 
    
        // set the dimensions and margins of the graph
var margin = {top: 0, right: 0, bottom: 0, left: 5},
    width = 600 - margin.left - margin.right,
    height = 850 - margin.top - margin.bottom;

var Tooltip = d3.select("#viz_occupation")
    .append("div")
    .style("position", "sticky")
    .style("opacity", 0)
    .attr("width", 80)
    .attr("height", 30)
    .attr("class", "tooltip")
    .style("display", "inline")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2.9px")
    .style("border-radius", "0px")
    .style("padding", "5px")
    .style("z-index", 99)
    
// append the svg object to the body of the page
var svg_occupation = d3.select("#viz_occupation")
  .append("svg")
    //.attr("width", width + margin.left + margin.right)
    //.attr("height", height + margin.top + margin.bottom)
  .classed("svg_container-totalmigrant",true)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

// Parse the Data
d3.csv("https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/data_occupation_all.csv", function(data) {

  // List of subgroups = header of the csv files 
  var subgroups = data.columns.slice(1)

  // List of groups = species here = value of the first column called group -> I show them on the X axis
  var groups = d3.map(data, function(d){return(d.Group)}).keys()

  // Add X axis
  var x = d3.scaleBand()
      .domain(groups)
      .range([0, width])
      .padding([0.5])

  
  svg_occupation.append("g")
    .attr("transform", "translate(0," + height + ")");
    //.call(d3.axisBottom(x).tickSizeOuter(0));

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([0, 100])
    .range([ height, 0 ]);
  //svg.append("g")
    //.call(d3.axisLeft(y));

  // color palette = one color per subgroup
  var color = d3.scaleOrdinal()
    .domain(subgroups)
    //.range(['#FFFFFF'])
    .range(['#3DADFE','#F628C6','#47E380'])

  // Normalize the data -> sum of each group must be 100!
//  console.log(data)
  dataNormalized = []
  data.forEach(function(d){
    // Compute the total
    tot = 0
    for (i in subgroups){ name=subgroups[i] ; tot += +d[name] }
    // Now normalize
    for (i in subgroups){ name=subgroups[i] ; d[name] = d[name] / tot * 100}
  })

  //stack the data? --> stack per subgroup
  var stackedData = d3.stack()
    .keys(subgroups)
    (data)


  // ----------------
  // Highlight a specific subgroup when hovered
  // ----------------

  // What happens when user hover a bar
  var mouseover_occupation = function(d) {
    // what subgroup are we hovering?
    var subgroupName = d3.select(this.parentNode).datum().key; // This was the tricky part
      subgroupName=subgroupName.replace(/\s/g, '');
//      console.log(subgroupName)
    var subgroupValue = d.data[subgroupName];
    // Reduce opacity of all rect to 0.2
//    this.setAttribute("fill", function(d, i) { 
//
//                return color(d)
//        
//        })

    // Highlight all rects of this subgroup with opacity 0.8. It is possible to select them since they have a specific class = their name.
    d3.selectAll(".myRect")
      .style("opacity",0.2)
      d3.selectAll("."+subgroupName)
      .style("opacity", 1)
      
    Tooltip
      .style("opacity", 1)
    }

  // When user do not hover anymore
  var mouseleave_occupation = function(d) {
          var subgroupName = d3.select(this.parentNode).datum().key; // This was the tricky part
//      console.log(subgroupName)
    var subgroupValue = d.data[subgroupName];
    // Back to normal opacity: 0.8
    d3.selectAll(".myRect")
      .style("opacity",1)
    Tooltip
      .style("opacity", 0)
      
    d3.selectAll("."+subgroupName)
      .style("opacity", 1)
    }

  

    // When user do not hover anymore
  var mousemove_occupation = function(d, i) {
      
      
      var subgroupName = d3.select(this.parentNode).datum().key;
    var subgroupValue = d.data[subgroupName];
      
      console.log(subgroupName, subgroupValue)
      
      

console.log(d, i);
      console.log(this.getAttribute("value"))
      
    Tooltip

      .html( subgroupName + ": " + Math.round(parseFloat(subgroupValue) ) + "%")
      .style("left", (d3.mouse(this)[0] +160) + "px")
      .style("top", (d3.mouse(this)[1] +30) + "px")

    }

    
    
  // Show the bars
  svg_occupation.append("g")
    .selectAll("g")
    // Enter in the stack data = loop key per key = group per group
    .data(stackedData)
    .enter().append("g")
      .attr("fill", function(d, i) { 
            console.log(stackedData)
      
            return color(d)
        })
      .attr("class", function(d){ return "myRect " + d.key })
      .selectAll("rect")
      // enter a second time = loop subgroup per subgroup to add all rectangles
      .data(function(d) { return d; })
      .enter().append("rect")
        .attr("y", function(d) { return x(d.data.Group); })
        .attr("x", function(d) { return y(d[1]); })
        .attr("width", function(d) { return y(d[0]) - y(d[1]); })
        .attr("height",x.bandwidth())
        .attr("stroke", "black",)
        .attr("stroke-width", 2.5,)
        .attr("class", function(d, i){ return "rect-" + d.data.Group })
        .attr("fill", function(d, i) { 
//            console.log(this.parentNode.getAttribute("class"))
//            console.log(d)
            if (this.parentNode.getAttribute("class") == "myRect AgriculturalProductionOrLabor") {
                return color(d)
            }
            else {
                return ['#FFFFFF']
            }
        }
         )
   
    

    
      .on("mouseover", mouseover_occupation)
      .on("mouseleave", mouseleave_occupation)
      .on("mousemove", mousemove_occupation)

    
});
    
    
}

        
        
    
        
        
        
  
            
//////////////////       
            
//OCCUPATION CHART    (AFTER_2)
    
//////////////////
//
//
//const buildOccupationAfterChart = function() {
//
//// set the dimensions and margins of the graph
//var margin = {top: 0, right: 0, bottom: 0, left: 5},
//    width = 600 - margin.left - margin.right,
//    height = 850 - margin.top - margin.bottom;
//
//var TooltipAfter = d3.select("#viz_occupation_after")
//    .append("div")
//    .style("position", "sticky")
//    .style("opacity", 0)
//    .attr("width", 80)
//    .attr("height", 30)
//    .attr("class", "tooltip")
//    .style("display", "inline")
//    .style("background-color", "white")
//    .style("border", "solid")
//    .style("border-width", "2.9px")
//    .style("border-radius", "0px")
//    .style("padding", "5px")
//    .style("z-index", 99)
//    
//// append the svg object to the body of the page
//var svg_occupation_after = d3.select("#viz_occupation_after")
//  .append("svg")
////     .attr("width", width + margin.left + margin.right)
////    .attr("height", height + margin.top + margin.bottom)
//  .classed("svg_container-totalmigrant",true)
//  .append("g")
//    .attr("transform",
//          "translate(" + margin.left + "," + margin.top + ")");
//
//
//    
//// Parse the Data
//d3.csv("https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/data_occupation_after.csv", function(data) {
//
//  // List of subgroups = header of the csv files = soil condition here
//  var subgroups = data.columns.slice(1)
//
//  // List of groups = species here = value of the first column called group -> I show them on the X axis
//  var groups = d3.map(data, function(d){return(d.group)}).keys()
//
//  // Add X axis
//  var x = d3.scaleBand()
//      .domain(groups)
//      .range([0, width])
//      .padding([0.5])
//  
//  
//  svg_occupation_after.append("g")
//    .attr("transform", "translate(0," + height + ")")
////    .call(d3.axisBottom(x).tickSizeOuter(0));
//
//  // Add Y axis
//  var y = d3.scaleLinear()
//    .domain([0, 100])
//    .range([ height, 0 ]);
////  svg.append("g")
////    .call(d3.axisLeft(y));
//
//  // color palette = one color per subgroup
//  var color = d3.scaleOrdinal()
//    .domain(subgroups)
////    .range(['#FFFFFF'])
//    .range(['#3DADFE','#F628C6','#47E380'])
//
//  // Normalize the data -> sum of each group must be 100!
////  console.log(data)
//  dataNormalized = []
//  data.forEach(function(d){
//    // Compute the total
//    tot = 0
//    for (i in subgroups){ name=subgroups[i] ; tot += +d[name] }
//    // Now normalize
//    for (i in subgroups){ name=subgroups[i] ; d[name] = d[name] / tot * 100}
//  })
//
//  //stack the data? --> stack per subgroup
//  var stackedData = d3.stack()
//    .keys(subgroups)
//    (data)
//  
//  
//// ----------------
//  // Highlight a specific subgroup when hovered
//  // ----------------
//  
//  // What happens when user hover a bar
//var mouseover_occupation_after = function(d) {
//    // what subgroup are we hovering?
//    var subgroupName = d3.select(this.parentNode).datum().key; // This was the tricky part
//      subgroupName=subgroupName.replace(/\s/g, '');
////      console.log(subgroupName)
//    var subgroupValue = d.data[subgroupName];
//    // Reduce opacity of all rect to 0.2
////    this.setAttribute("fill", function(d, i) { 
////
////                return color(d)
////        
////        })
//
//    // Highlight all rects of this subgroup with opacity 0.8. It is possible to select them since they have a specific class = their name.
//    d3.selectAll(".myRect")
//      .style("opacity",0.2)
//      d3.selectAll("."+subgroupName)
//      .style("opacity", 1)
//    
//    TooltipAfter
//        .style("opacity", 1)
//    }
//    
//    
//
//  // When user do not hover anymore
//  var mouseleave_occupation_after = function(d) {
//          var subgroupName = d3.select(this.parentNode).datum().key; // This was the tricky part
////      console.log(subgroupName)
//    var subgroupValue = d.data[subgroupName];
//    // Back to normal opacity: 0.8
//    d3.selectAll(".myRect")
//      .style("opacity",1)
//    TooltipAfter
//      .style("opacity", 0)
//      
//    d3.selectAll("."+subgroupName)
//      .style("opacity", 1)
//    }
//
//
//
//  // When user do not hover anymore
//  var mousemove_occupation_after = function(d, i) {
//      
//      
//      var subgroupName = d3.select(this.parentNode).datum().key;
//    var subgroupValue = d.data[subgroupName];
//      
//      console.log(subgroupName, subgroupValue)
//      
//      
//
//console.log(d, i);
//      console.log(this.getAttribute("value"))
//      
//    TooltipAfter
//
//      .html( subgroupName + ": " + Math.round(parseFloat(subgroupValue) ) + "%")
//      .style("left", (d3.mouse(this)[0] +150) + "px")
//      .style("top", (d3.mouse(this)[1] +280) + "px")
//
//
//    }
//
//
//  // Show the bars
//  svg_occupation_after.append("g")
//    .selectAll("g")
//    // Enter in the stack data = loop key per key = group per group
//    .data(stackedData)
//    .enter().append("g")
//      .attr("fill", function(d, i){
//      
//            return color(d)
//        })
//      .attr("class", function(d){ return "myRect " + d.key }) // Add a class to each subgroup: their name
//      .selectAll("rect")
//      // enter a second time = loop subgroup per subgroup to add all rectangles
//      .data(function(d) { return d; })
//      .enter().append("rect")
//        .attr("y", function(d) { return x(d.data.group); })
//        .attr("x", function(d) { return y(d[1]); })
//        .attr("width", function(d) { return y(d[0]) - y(d[1]); })
//        .attr("height",x.bandwidth())
//        .attr("stroke", "black",)
//        .attr("stroke-width", 2.5,)
//        .attr("class", function(d, i){ return "rect-" + d.data.Group })
//        .attr("fill", function(d, i) { 
////            console.log(this.parentNode.getAttribute("class"))
////            console.log(d)
//            if (this.parentNode.getAttribute("class") == "myRect AgriculturalProductionOrLabor") {
//                return color(d)
//            }
//            else {
//                return ['#FFFFFF']
//            }
//        }
//         )
//     
//    
//    
//    
//    
//      .on("mouseover", mouseover_occupation_after)
//      .on("mouseleave", mouseleave_occupation_after)
//      .on("mousemove", mouseleave_occupation_after)
//
//});
//
//
//
//}
        
        
    

//////////////////////////
///////  TREE MAP  ///////
///////  HND 2019  ///////
//////////////////////////
    

const buildHND2019Chart = function() {

// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 0, left: 0},
  width = 870 - margin.left - margin.right,
  height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#viz_treemap_hnd_2019")
    .append("svg")
     .attr("id","svg_viz_treemap_hnd_2019") //change the id for total export svg 
            .attr("display","block") // display == none for total export svg
            .attr("width", "100%")
            .attr("height", "100%")
    .classed("svg_container-totalmigrant",true)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");


// Read data
d3.csv('https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/Export_HND_gross_2019.csv', function(data) {

  // stratify the data: reformatting for d3.js
  var root = d3.stratify()
    .id(function(d) { return d.name; })   // Name of the entity (column name is name in csv)
    .parentId(function(d) { return d.parent; })   // Name of the parent (column name is parent in csv)
    (data);
  root.sum(function(d) { return +d.value })   // Compute the numeric value for each entity

  // Then d3.treemap computes the position of each element of the hierarchy
  // The coordinates are added to the root object above
  d3.treemap()
    .size([width, height])
    .padding(7)
    (root)

console.log(root.leaves())
  // use this information to add rectangles:
  svg
    .selectAll("rect")
    .data(root.leaves())
    .enter()
    .append("rect")
      .attr('x', function (d) { return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', function (d) { return d.x1 - d.x0; })
      .attr('height', function (d) { return d.y1 - d.y0; })
      .style("stroke", "black")
      .style("stroke-width", "2.75")
  
    .style("fill",  function (d) { 
            if (d.id == "Agriculture") {
                return "#3DADFE"  
            }
            else {
                return "#FFFFFF"
            }
        } );

  // and to add the text labels
  svg
    .selectAll("text")
    .data(root.leaves())
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.name})
      .attr("font-size", "12px")
      .attr("fill", "Black")
})
        

}
    
    
    
//////////////////////////
///////  TREE MAP  ///////
///////  HND 2020  ///////
//////////////////////////
    

const buildHND2020Chart = function() {


// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 0, left: 0},
  width = 870 - margin.left - margin.right,
  height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#viz_treemap_hnd_2020")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// Read data
d3.csv('https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/Export_HND_gross_2020.csv', function(data) {

  // stratify the data: reformatting for d3.js
  var root = d3.stratify()
    .id(function(d) { return d.name; })   // Name of the entity (column name is name in csv)
    .parentId(function(d) { return d.parent; })   // Name of the parent (column name is parent in csv)
    (data);
  root.sum(function(d) { return +d.value })   // Compute the numeric value for each entity

  // Then d3.treemap computes the position of each element of the hierarchy
  // The coordinates are added to the root object above
  d3.treemap()
    .size([width, height])
    .padding(7)
    (root)

console.log(root.leaves())
  // use this information to add rectangles:
  svg
    .selectAll("rect")
    .data(root.leaves())
    .enter()
    .append("rect")
      .attr('x', function (d) { console.log(d.id); return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', function (d) { return d.x1 - d.x0; })
      .attr('height', function (d) { return d.y1 - d.y0; })
      .style("stroke", "black")
      .style("stroke-width", "2.75")
  
      .style("fill",  function (d) { 
            if (d.id == "Agriculture") {
                return "#3DADFE"
            }
            else {
                return "#FFFFFF"
            }
        } );

  // and to add the text labels
  svg
    .selectAll("text")
    .data(root.leaves())
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.name})
      .attr("font-size", "12px")
      .attr("fill", "Black")
})
    
}
    
    
//////////////////////////
///////  TREE MAP  ///////
///////  SLV 2019  ///////
////////////////////////// 
    

const buildSLV2019Chart = function() {

// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 0, left: 0},
  width = 870 - margin.left - margin.right,
  height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#viz_treemap_slv_2019")
    .append("svg")
     .attr("id","svg_viz_treemap_slv_2019") //change the id for total export svg 
            .attr("display","block") // display == none for total export svg
            .attr("width", "100%")
            .attr("height", "100%")
    .classed("svg_container-totalmigrant",true)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

// Read data
d3.csv('https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/Export_SLV_gross_2019.csv', function(data) {

  // stratify the data: reformatting for d3.js
  var root = d3.stratify()
    .id(function(d) { return d.name; })   // Name of the entity (column name is name in csv)
    .parentId(function(d) { return d.parent; })   // Name of the parent (column name is parent in csv)
    (data);
  root.sum(function(d) { return +d.value })   // Compute the numeric value for each entity

  // Then d3.treemap computes the position of each element of the hierarchy
  // The coordinates are added to the root object above
  d3.treemap()
    .size([width, height])
    .padding(7)
    (root)

console.log(root.leaves())
  // use this information to add rectangles:
  svg
    .selectAll("rect")
    .data(root.leaves())
    .enter()
    .append("rect")
      .attr('x', function (d) { return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', function (d) { return d.x1 - d.x0; })
      .attr('height', function (d) { return d.y1 - d.y0; })
      .style("stroke", "black")
      .style("stroke-width", "2.75")
  
      .style("fill",  function (d) { 
            if (d.id == "Agriculture") {
                return "#F628C6" 
            }
            else {
                return "#FFFFFF"
            }
        } );

  // and to add the text labels
  svg
    .selectAll("text")
    .data(root.leaves())
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.name})
      .attr("font-size", "12px")
      .attr("fill", "Black")
})
    
    
}
    
    

    
//////////////////////////
///////  TREE MAP  ///////
///////  SLV 2020  ///////
////////////////////////// 
    

const buildSLV2020Chart = function() {


// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 0, left: 0},
  width = 870 - margin.left - margin.right,
  height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#viz_treemap_slv_2020")
  .append("svg")
.attr("id","svg_viz_treemap_slv_2020") //change the id for total export svg 
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("display","block") 
    .classed("svg_container-totalmigrant",true)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");


// Read data
d3.csv('https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/Export_SLV_gross_2020.csv', function(data) {

  // stratify the data: reformatting for d3.js
  var root = d3.stratify()
    .id(function(d) { return d.name; })   // Name of the entity (column name is name in csv)
    .parentId(function(d) { return d.parent; })   // Name of the parent (column name is parent in csv)
    (data);
  root.sum(function(d) { return +d.value })   // Compute the numeric value for each entity

  // Then d3.treemap computes the position of each element of the hierarchy
  // The coordinates are added to the root object above
  d3.treemap()
    .size([width, height])
    .padding(7)
    (root)

console.log(root.leaves())
  // use this information to add rectangles:
  svg
    .selectAll("rect")
    .data(root.leaves())
    .enter()
    .append("rect")
      .attr('x', function (d) { return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', function (d) { return d.x1 - d.x0; })
      .attr('height', function (d) { return d.y1 - d.y0; })
      .style("stroke", "black")
      .style("stroke-width", "2.75")
  
      .style("fill",  function (d) { 
            if (d.id == "Agriculture") {
                return "#F628C6"
            }
            else {
                return "#FFFFFF"
            }
        } );

  // and to add the text labels
  svg
    .selectAll("text")
    .data(root.leaves())
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.name})
      .attr("font-size", "12px")
      .attr("fill", "Black")
})
    
    
}
    

//////////////////////////
///////  TREE MAP  ///////
///////  GTM 2019  ///////
////////////////////////// 
    
const buildGTM2019Chart = function() {

// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 0, left: 0},
  width = 870 - margin.left - margin.right,
  height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page
    var svg = d3.select("#viz_treemap_gtm_2019")
    .append("svg")
     .attr("id","svg_viz_treemap_gtm_2019") //change the id for total export svg 
            .attr("display","block") // display == none for total export svg
            .attr("width", "100%")
            .attr("height", "100%")
    .classed("svg_container-totalmigrant",true)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

// Read data
d3.csv('https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/Export_GTM_gross_2019.csv', function(data) {

  // stratify the data: reformatting for d3.js
  var root = d3.stratify()
    .id(function(d) { return d.name; })   // Name of the entity (column name is name in csv)
    .parentId(function(d) { return d.parent; })   // Name of the parent (column name is parent in csv)
    (data);
  root.sum(function(d) { return +d.value })   // Compute the numeric value for each entity

  // Then d3.treemap computes the position of each element of the hierarchy
  // The coordinates are added to the root object above
  d3.treemap()
    .size([width, height])
    .padding(7)
    (root)

console.log(root.leaves())
  // use this information to add rectangles:
  svg
    .selectAll("rect")
    .data(root.leaves())
    .enter()
    .append("rect")
      .attr('x', function (d) { return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', function (d) { return d.x1 - d.x0; })
      .attr('height', function (d) { return d.y1 - d.y0; })
      .style("stroke", "black")
      .style("stroke-width", 2.5)
  
      .style("fill",  function (d) { 
            if (d.id == "Agriculture") {
                return "#47E380"
            }
            else {
                return "#FFFFFF"
            }
        } );

  // and to add the text labels
  svg
    .selectAll("text")
    .data(root.leaves())
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.name})
      .attr("font-size", "12px")
      .attr("fill", "Black")
})
    
}

    
//////////////////////////
///////  TREE MAP  ///////
///////  GTM 2020  ///////
////////////////////////// 
    

const buildGTM2020Chart = function() {

// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 0, left: 0},
  width = 870 - margin.left - margin.right,
  height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page
    var svg = d3.select("#viz_treemap_gtm_2020")
       .append("svg")
        .attr("width", "100%")
        .attr("height", "100%")
        .attr("display","block") 
        .classed("svg_container-totalmigrant",true)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");


// Read data
d3.csv('https://raw.githubusercontent.com/jprachasartta/11.154-fall-2021/main/Export_GTM_gross_2020.csv', function(data) {

  // stratify the data: reformatting for d3.js
  var root = d3.stratify()
    .id(function(d) { return d.name; })   // Name of the entity (column name is name in csv)
    .parentId(function(d) { return d.parent; })   // Name of the parent (column name is parent in csv)
    (data);
  root.sum(function(d) { return +d.value })   // Compute the numeric value for each entity

  // Then d3.treemap computes the position of each element of the hierarchy
  // The coordinates are added to the root object above
  d3.treemap()
    .size([width, height])
    .padding(8)
    (root)

console.log(root.leaves())
  // use this information to add rectangles:
  svg
    .selectAll("rect")
    .data(root.leaves())
    .enter()
    .append("rect")
      .attr('x', function (d) { return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', function (d) { return d.x1 - d.x0; })
      .attr('height', function (d) { return d.y1 - d.y0; })
      .style("stroke", "black")
      .style("stroke-width", "2.5")
  
      .style("fill",  function (d) { 
            if (d.id == "Agriculture") {
                return "#47E380"
            }
            else {
                return "#FFFFFF"
            }
        } );

  // and to add the text labels
  svg
    .selectAll("text")
    .data(root.leaves())
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ 
      
      text_str = d.data.name 
      return text_str
      
//      text_str = d.data.name + "   Exports: " + d.data.value
//      return text_str
  })
      .attr("font-size", "12px")
      .attr("fill", "Black")
})

}


      
        
         </script>
        
    </body>
    
</html>